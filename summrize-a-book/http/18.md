# 18. 웹 호스팅

콘텐츠 리소스를 저장, 중개, 관리하는 일을 통틀어 웹 호스팅이라 한다. 호스팅은 웹 서버의 가장 중요한 기능 중 하나다.

## 호스팅 서비스

### 전용 호스팅

직접 자체 서버를 구매하고 서버 소프트웨어를 직접 유지보수하는 대신 고성능 웹 서버를 구성할 수 있다.

## 가상 호스팅

많은 웹 호스팅 업자는 컴퓨터 한 대를 여러 고객이 공유하게 해서 저렴한 웹 호스팅 서비스를 제공한다. 이를 공유 호스팅 혹은 가상 호스팅이라 부른다. 각 웹사이트는 다른 서버에서 호스팅하는 것처럼 보이겠지만, 사실은 물리적으로 같은 서버에서 호스팅되는 것이다. 최종 사용자의 관점에서 가상 호스팅에 있는 웹 사이트는, 물리적으로 분리된 전용 서버에서 호스팅 하는 사이트와 구분할 수 없어야 한다.

### 호스트 정보가 없는 가상 서버 요청

HTTP/1.0 명세는 공용 웹 서버가 호스팅하고 있는 가상 웹 사이트에 누가 접근하고 있는지 식별하는 기능을 제공하지 않는다. 이를 해결하기 위해 4가지 기술이 나왔다

#### URL 경로를 통한 가상 호스팅

공용 서버에 있는 각 가상 사이트에 서로 다른 URL 경로를 할당해서 각각을 강제로 구분할 수 있다. 하지만 불필요한 경로가 생기며 좋지 않은 방법이다.

#### 포트번호를 통한 가상 호스팅

웹 서버에 각각 다른 포트번호를 할당할 수 있다. 하지만 사용자는 URL에 비표준 포트를 쓰지 않고서도 리소스를 찾길 원하기 때문에 좋은 방법이 아니다.

#### IP 주소를 통한 가상 호스팅

각 가상 웹 사이트에 유일한 IP 주소를 한 개 이상 부여한다. 하지만 IP는 희소 상품이며 제한이 있어서 좋은 방법이 아니다.

#### Host 헤더를 통한 가상 호스팅

모든 요청에 호스트명\(그리고 포트\)을 Host 확장 헤더에 기술해서 전달한다. HTTP/1.1 명세를 따르려면 Host 헤더를 반드시 기술해야 한다. 웹 프락시는 요청을 전달하기 전에 요청 메시지에 Host 헤더를 추가해야 한다.

```http
GET /index.html HTTP/1.1
User-Agent: SuperBrowser v1.3
Host: www.haky.com
```

#### Host 헤더 해석하기

가상 호스팅을 지원하지 않는 원 서버는 요청 받는 호스트에 따라서 리소스가 달라지지 않기 때문에 Host 헤더 값을 무시할 것이다. 하지만 호스트를 기준으로 리소스를 구분하는 모든 웹 서버는 HTTP/1.1을 통해 오는 리소스를 결정하려면 다음과 같은 규칙을 사용해야 한다.

1. HTTP 요청에 전체 URL이 기술되어 있으면 Host 헤더 값은 무시하고 URL을 사용한다.
2. URL에 호스트 명이 기술되어 있지 않고 요청에 Host 헤더가 있으면, Host 헤더를 사용한다.
3. 1, 2단계를 통해 호스트를 결정할 수 없으면 클라이언트에 400 응답을 반환한다.

## 안정적인 웹 사이트 만들기

### 미러링 된 서버 팜

서버팜은 서로 대신할 수 있고 식별할 수 있게 설정된 웹 서버들의 집합이다. 서버팜의 서버에 있는 콘텐츠들은 한 곳에 문제가 생기면 다른 한 곳에서 대신 전달할 수 있게 미러링 할 수 있다.

### 콘텐츠 분산 네트워크

CDN은 특정 콘텐츠의 분산을 목적으로 하는 단순한 네워크이다. 네트워크의 노드는 서버, 대리 서버, 혹은 프락시 서버가 될 수 있다.

### CDN의 대리 캐시

리버스 프락시라고도 불리는 대리 서버는 미러링 된 웹 서버처럼 콘텐츠에 대한 요청을 받는다. 그들은 특정 원 서버 집합을 대신해 요청을 받는다. \(이는 콘텐츠에 대한 IP주소가 알려졌기 때문에 가능하다. 보통 원 서버와 대리 서버가 연결되며, 대리 서버는 특정 원 서버를 가리키는 요청을 받는다.\)

대리 서버와 미러링 된 서버의 차이점은, 대리 서버는 보통 수요에 따라서 동작한다는 것이다. 대리 서버는 원 서버의 전체 콘텐츠를 복사하지는 않는다. 클라이언트가 요청하는 코넨츠만 저장할 뿐이다. 원 서버는 그들의 콘텐츠를 업데이트해줄 의무는 없다.

## 참고

* [Host 헤더](https://developer.mozilla.org/ko/docs/Web/HTTP/Headers/Host)

